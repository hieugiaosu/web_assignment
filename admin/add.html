<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
	<link rel="stylesheet" href="css_format/test.css">
    <title>My website</title>
   
</head>
<body>
    <div class="container-fluid">
        <div id="headerid" class="mb-5">
            <!-- header here -->
        </div>
        <div class="container mt-5">
            <nav aria-label="breadcrumb" class="pt-5">
                <ol class="breadcrumb mt-2">
                    <li class="breadcrumb-item" aria-current="page"><a href="../index.html">Home</a></li>
                    <li class="breadcrumb-item" aria-current="page"><a href="products_list.html">Danh mục sản phẩm</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Thêm sản phẩm</li>
                </ol>
                </nav>
        <form class="row" action="php_server/add_product.php" method="post" id="add_form">
            <div class="col-md-6 pe-2">
            <div class="my-1 d-flex">
                <label for="product_id" class="form-label me-2">ID sản phẩm:</label>
                <input type="number" class="form-control w-25" id="product_id" name="product_id" aria-describedby="validate_id" placeholder="Nhập ID" required>
            </div>
            <div class="form-text text-danger" id="validate_id"></div>
            <div class="my-1">
                <label for="product_name" class="form-label">Tên sản phẩm:</label>
                <input type="text" id="product_name" name="product_name" class="form-control w-100" placeholder="Nhập tên sản phẩm" required>
            </div>
            <div class="my-1">
                <label class="form-label" for="product_description">Mô tả:</label>
                <textarea class="form-control w-100" rows="5" id="product_description" name="product_description" placeholder="Nhập mô tả" required></textarea>
            </div>
            </div>
            <div class="col-md-6">
                <div class="d-flex">
                <div class="form-label">Size:</div>
                <div class="form-check mx-5 d-flex" id="check-area">
                    <div class="mx-2">
                    <input class="form-check-input mx-2" type="checkbox" value="S" id="size_s" name="size_s">
                    <label class="form-check-label" for="size_s">
                        S
                    </label>
                    </div>
                    <div class="mx-2">
                    <input class="form-check-input mx-2" type="checkbox" value="M" id="size_m" name="size_m">
                    <label class="form-check-label" for="size_m">
                        M
                    </label>
                    </div>
                    <div class="mx-2">
                    <input class="form-check-input mx-2" type="checkbox" value="L" id="size_l" name="size_l">
                    <label class="form-check-label" for="size_l">
                        L
                    </label>
                    </div>
                  </div>
                </div>
                <div class="my-1">
                    <div class="form-group d-flex">
                        <label for="product_type" class="form-label w-auto me-3">Loại sản phẩm:</label>
                        <select class="form-select w-auto" id="product_type" name="product_type">
                          <option value="T-SHIRT" selected>T-SHIRT</option>
                          <option value="HOODIE">HOODIE</option>
                          <option value="SHORT PANTS">SHORT PANTS</option>
                          <option value="JEANS">JEANS</option>
                          <option value="WALLET">WALLET</option>
                        </select>
                      </div>
                </div>
                <div class="my-1"> 
                    <div>
                        Màu sắc:
                    </div>
                    <div class="d-flex">
                        <input type="text" class="form-control w-50" id="color_name" placeholder="Nhập màu">
                        <button type="button" class="btn btn-primary" id="add_color_button">Thêm màu</button>
                        <button type="button" class="btn btn-danger" id="del_color_button">Xóa màu</button>
                    </div>
                    <textarea type="text" class="mt-1 form-control" id="color_list" name="color_list" disabled></textarea>
                </div>
                <div class="my-1 d-flex">
                    <label for="product_price" class="form-label mx-2">Giá sản phẩm:</label>
                    <input type="number" class="form-control w-50" id="product_price" name="product_price" placeholder="Nhập giá" required>
                </div>
                <div class="my-1 d-flex">
                    <label for="quantity" class="form-label mx-2">Số lượng:</label>
                    <input type="number" class="form-control w-50" id="quantity" name="quantity" placeholder="Nhập giá" value="0" required>
                </div>
            </div>
            <div class="my-1 row">
                <div class="d-flex">
                    <label class="form-label mx-2" for="link">Hình ảnh:</label>
                    <input type="text" class="form-control w-50 mx-2" id="link" placeholder="Nhập liên kết">
                    <button type="button" class="btn btn-primary" id="add_image_button">Thêm Ảnh</button>
                </div>
            </div>
            <div class="my-1 row" id="show-images">
                <div class="col-md-2">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/Picture_icon_BLACK.svg" class="w-100 img-thumbnail" alt="image1">
                    <button type="button" class="btn btn-sm btn-secondary deleteImage" onclick="deleteImage(0)">Xóa</button>
                </div>
                <div class="col-md-2">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/Picture_icon_BLACK.svg" class="w-100 img-thumbnail" alt="image2">
                    <button type="button" class="btn btn-sm btn-secondary deleteImage" onclick="deleteImage(1)">Xóa</button>
                </div>
                <div class="col-md-2">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/Picture_icon_BLACK.svg" class="w-100 img-thumbnail" alt="image3">
                    <button type="button" class="btn btn-sm btn-secondary deleteImage" onclick="deleteImage(2)">Xóa</button>
                </div>
                <div class="col-md-2">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/Picture_icon_BLACK.svg" class="w-100 img-thumbnail" alt="image4">
                    <button type="button" class="btn btn-sm btn-secondary deleteImage" onclick="deleteImage(3)">Xóa</button>
                </div>
                <div class="col-md-2">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/Picture_icon_BLACK.svg" class="w-100 img-thumbnail" alt="image5">
                    <button type="button" class="btn btn-sm btn-secondary deleteImage" onclick="deleteImage(4)">Xóa</button>
                </div> 
            </div>
            <div>
                <input type="hidden" name="image_list" id="image_list">
            </div>
            <div class="row justify-content-end">
                <button type="submit" class="btn btn-sm w-auto px-5 btn-success" id="submit" disabled>Thêm</button>
            </div>
        </form>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script>
        let color_list = [];
        let image_list = [];
        function showImage(){
            if (image_list.length == 5) $("#add_image_button").attr("disabled",true);
                else $("#add_image_button").attr("disabled",false);
            let image = $(".img-thumbnail");
            let deleteImage = $(".deleteImage");
            for (let i = 0; i < 5; i++) {
                if (i<image_list.length){
                    image[i].setAttribute("src",image_list[i]);
                    deleteImage[i].hidden = false;
                } else {
                    image[i].setAttribute("src","https://upload.wikimedia.org/wikipedia/commons/6/6b/Picture_icon_BLACK.svg");
                    deleteImage[i].hidden = true;
                }
            }
            $("#image_list").val(image_list.join(", "));
        }
        function deleteImage(x){
            image_list.splice(x,1);
            showImage();
        }
        $("form").submit(function(){
            $("#color_list").attr("disabled",false);
        });
        function submit_valid(){
            let checked = $("input[type=checkbox]:checked").length;
            $.ajax(
                {
                    url: 'php_server/validate_product_id.php',
                    type: 'POST',
                    data: {
                        product_id:$("#product_id").val()
                    },
                    success: function(data) {
                        if (data == false){
                            $("#validate_id").html("ID đã tồn tại");
                            }
                        else{ 
                            $("#validate_id").html("");
                            }
                        $("#submit").attr("disabled", (!checked)&&data);
                        },
                    error: function(xhr, status, error) {
                        console.log('Error: ' + error);
                        location.href = "/btl/page_not_found.html"
                        }
                    
                }
            )
        }
        function showHeader(){
                $.ajax(
                    {
                        url: 'header.php',
                        type: 'GET',
                        success: function(data) {
                            $("#headerid").html(data);
                            }, 
                        error: function(xhr, status, error) {
                            console.log('Error: ' + error);
                            }
                    }
                )
            }
        $("#add_image_button").click(function(){
            let image_link = $("#link").val();
            if (image_link) image_list.push(image_link);
            showImage();
            $("#link").val("");
        });
        showHeader();
        $("#add_color_button").click(function(){
            let color = $("#color_name").val();
            if (!(color_list.includes(color))){
                color_list.push(color);
            }
            $("#color_name").val("");
            $("#color_list").html(color_list.join(", "));
        });
        $("#del_color_button").click(function(){
            let color = $("#color_name").val();
            if (color_list.includes(color)){
                let idx = color_list.indexOf(color);
                color_list.splice(idx,1)
            }
            $("#color_name").val("");
            $("#color_list").html(color_list.join(", "));
        });
        $("#product_id").change(submit_valid);
        $("#check-area").click(submit_valid);
        showImage();
    </script>
</body>
</html>